<div class="web-scraping">
    
</div>
<script type="text/javascript">
var resScraping = undefined;
function getDetail() {
    var params = {};
    var genre = "";
    for(var detail in resScraping) {
        params[detail] = resScraping[detail];
    }
    $.post("/restricted/collection/videogame/scraping/feltrinelli", {
            exec : true
            , obj : JSON.stringify(params)	
    }).done(function( data ) {
		var res = resScraping[detail]["detail"].push({
                "cover"					: jQuery('IMG[itemprop="image"]', data["tpl"].trim()).first().attr("src")
                , "genere"				: jQuery('#block-more-info LI:first A', data["tpl"].trim()).text()
                , "publisher"			: jQuery('SPAN:contains("Produttore:")', data["tpl"].trim()).parent().find(".value").text()
                , "description"			: jQuery('.block-content P:first', data["tpl"].trim()).text()
        });
        resScraping[detail]["loaded"] = true;
        closeDetail();
    }); 
}
function closeDetail() {
    $.post("/restricted/collection/videogame/scraping/feltrinelli", {
                exec : true
                , videogame : JSON.stringify(resScraping)	
    }).done(function( data ) {

    });
}

if(resScraping === undefined) {
        resScraping = {};
        
        var params = {
                "url" : "http://www.lafeltrinelli.it/fcom/it/home/pages/catalogo/searchresults.html?prkw={videogame_title}&platformId={ID_console}"
        };
        
        $.post("/restricted/collection/videogame/scraping/feltrinelli", {
                exec : true
                , params : JSON.stringify(params)	
        }).done(function( data ) {
            
            var string_url = jQuery(".product-search-result-list .description A", data["tpl"].trim()).first().attr("href");
            var title = jQuery(".product-search-result-list .description A", data["tpl"].trim()).first().text().trim();
            resScraping[string_url] = {
                    "title"			: title
                    , "url"         : string_url
					, "ean"			: string_url.split("/").pop()
					, "smart_url"	: "{videogame_smart_url}"
                    , "detail"		: []
            };	
            getDetail();
});
} else {
        getDetail();
}
</script>